---
title: "Angstrom 2023 - LazyLagrange Challenge"
description: "Write up of the 'LazyLagrange Challenge' Challenge"
pubDate: "April 29 2023"
draft: true
---

import CodeFile from '../../components/CodeFile.astro'

I played in [Ã¥ngstromCTF](https://2023.angstromctf.com/) with [Zer0Tolerance](https://twitter.com/0tolerance_ctf).
One of the challenges I worked on was LazyLagrange. Here is a writeup for that challenge.

## LazyLagrange.py

The challenge description reads:
> Lagrange has gotten lazy, but he's still using Lagrange interpolation...or is he?

and comes with the following python file:

<CodeFile filename="angstrom23/lazylagrange.py" lang="python" / >

This script is running on a challenge server and gives you the following two options on connection:
- interpret a random permutation of the flag bytes as a polynomial which is sampled at max 10 points of user input. 
- compare the coefficients of the flag polynomial against user input and leak the permutation

Note also that 
- all operations on the polynomial are done in `mod (1 << 127) - 1`
- the flag is at most 18 bytes long
- the flag is entirely made up of printable ascii characters

## Solving

Here is how I extracted the coefficients of the permutated-flag-polynomial:

First I sampled the elusive polynomial at point `x = 0x80`.
Writing the resulting sampled point as a base-128 number gives the coefficients of the polynomial as base-128 digits.
Note that this only works for this challenge because:

$
128^{18} =  2^{126} < 2^{127} - 1
$
This has the consequences that none of the operations in evaluating the polynomial at `x = 0x80` will wrap.
Thus ensuring that the base-128 digits of the sample will actually be the coefficients of the polynomial.   

I extracted the 128-base digits using the following algorithm:
```python
def digits(y, base=0x80):
    while y > 0:
        digit = y % base
        yield digit
        y = (y - digit) // base
```
This step actually recovers the polynomial's coefficients aka. the permutated flag bytes which we can now send to the challenge server to obtain the permutation that scrambled the flag bytes into the coefficients. 
Inverting the permutation recovers the flag. 